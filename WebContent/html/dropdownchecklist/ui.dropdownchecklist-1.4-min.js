(function(e){e.widget("ui.dropdownchecklist",{version:function(){alert("DropDownCheckList v1.4")},_appendDropContainer:function(t){var n=e("<div/>");n.addClass("ui-dropdownchecklist ui-dropdownchecklist-dropcontainer-wrapper");n.addClass("ui-widget");n.attr("id",t.attr("id")+"-ddw");n.css({position:"absolute",left:"-33000px",top:"-33000px"});var r=e("<div/>");r.addClass("ui-dropdownchecklist-dropcontainer ui-widget-content");r.css("overflow-y","auto");n.append(r);n.insertAfter(t);n.isOpen=false;return n},_isDropDownKeyShortcut:function(t,n){return t.altKey&&e.ui.keyCode.DOWN==n},_isDropDownCloseKey:function(t,n){return e.ui.keyCode.ESCAPE==n||e.ui.keyCode.ENTER==n},_keyFocusChange:function(t,n,r){var i=e(":focusable");var s=i.index(t);if(s>=0){s+=n;if(r){var o=this.dropWrapper.find("input:not([disabled])");var u=i.index(o.get(0));var a=i.index(o.get(o.length-1));if(s<u){s=a}else if(s>a){s=u}}i.get(s).focus()}},_handleKeyboard:function(t){var n=this;var r=t.keyCode||t.which;if(!n.dropWrapper.isOpen&&n._isDropDownKeyShortcut(t,r)){t.stopImmediatePropagation();n._toggleDropContainer(true)}else if(n.dropWrapper.isOpen&&n._isDropDownCloseKey(t,r)){t.stopImmediatePropagation();n._toggleDropContainer(false);n.controlSelector.focus()}else if(n.dropWrapper.isOpen&&t.target.type=="checkbox"&&(r==e.ui.keyCode.DOWN||r==e.ui.keyCode.UP)){t.stopImmediatePropagation();n._keyFocusChange(t.target,r==e.ui.keyCode.DOWN?1:-1,true)}else if(n.dropWrapper.isOpen&&r==e.ui.keyCode.TAB){}},_handleFocus:function(t,n,r){var i=this;if(r&&!i.dropWrapper.isOpen){t.stopImmediatePropagation();if(n){i.controlSelector.addClass("ui-state-hover");if(e.ui.dropdownchecklist.gLastOpened!=null){e.ui.dropdownchecklist.gLastOpened._toggleDropContainer(false)}}else{i.controlSelector.removeClass("ui-state-hover")}}else if(!r&&!n){if(t!=null){t.stopImmediatePropagation()}i.controlSelector.removeClass("ui-state-hover");i._toggleDropContainer(false)}},_cancelBlur:function(e){var t=this;if(t.blurringItem!=null){clearTimeout(t.blurringItem);t.blurringItem=null}},_appendControl:function(){var t=this,n=this.sourceSelect,r=this.options;var i=e("<span/>");i.addClass("ui-dropdownchecklist ui-dropdownchecklist-selector-wrapper ui-widget");i.css({display:"inline-block",cursor:"default",overflow:"hidden"});var s=n.attr("id");if(s==null||s==""){s="ddcl-"+e.ui.dropdownchecklist.gIDCounter++}else{s="ddcl-"+s}i.attr("id",s);var o=e("<span/>");o.addClass("ui-dropdownchecklist-selector ui-state-default");o.css({display:"inline-block",overflow:"hidden","white-space":"nowrap"});var u=n.attr("tabIndex");if(u==null){u=0}else{u=parseInt(u);if(u<0){u=0}}o.attr("tabIndex",u);o.keyup(function(e){t._handleKeyboard(e)});o.focus(function(e){t._handleFocus(e,true,true)});o.blur(function(e){t._handleFocus(e,false,true)});i.append(o);var a=e("<div></div>");a.addClass("ui-dropdownchecklist-text");a.css({display:"inline-block","float":"left","white-space":"nowrap",overflow:"hidden"});o.append(a);if(r.icon!=null){var f=r.icon.placement==null?"left":r.icon.placement;var l=e("<div></div>");l.addClass("ui-icon");l.addClass(r.icon.toOpen!=null?r.icon.toOpen:"ui-icon-triangle-1-e");l.css("display","inline-block");l.css({"float":f});o.append(l)}i.hover(function(){if(!t.disabled){o.addClass("ui-state-hover")}},function(){if(!t.disabled){o.removeClass("ui-state-hover")}});i.click(function(e){if(!t.disabled){e.stopImmediatePropagation();t._toggleDropContainer(!t.dropWrapper.isOpen)}});i.insertAfter(n);e(window).resize(function(){if(!t.disabled&&t.dropWrapper.isOpen){t._toggleDropContainer(true)}});return i},_createDropItem:function(t,n,r,i,s,o,u,a){var f=this,l=this.options,c=this.sourceSelect,h=this.controlWrapper;var p=e("<div/>");p.addClass("ui-dropdownchecklist-item");p.css({"white-space":"nowrap"});var d=o?' checked="checked"':"";var v=u?' class="inactive"':' class="active"';var m=h.attr("id");var g=m+"-i"+t;var y;if(f.isMultiple){y=e('<input disabled type="checkbox" id="'+g+'"'+d+v+' tabindex="'+n+'" />')}else{y=e('<input disabled type="radio" id="'+g+'" name="'+m+'"'+d+v+' tabindex="'+n+'" />')}y=y.attr("index",t).val(r);p.append(y);var b=e("<label for="+g+"/>");b.addClass("ui-dropdownchecklist-text");if(s!=null)b.attr("style",s);b.css({cursor:"default"});b.html(i);if(a){p.addClass("ui-dropdownchecklist-indent")}p.addClass("ui-state-default");if(u){p.addClass("ui-state-disabled")}b.click(function(e){e.stopImmediatePropagation()});p.append(b);p.hover(function(t){var n=e(this);if(!n.hasClass("ui-state-disabled")){n.addClass("ui-state-hover")}},function(t){var n=e(this);n.removeClass("ui-state-hover")});y.click(function(t){var n=e(this);t.stopImmediatePropagation();if(n.hasClass("active")){var r=f.options.onItemClick;if(e.isFunction(r))try{r.call(f,n,c.get(0))}catch(i){n.prop("checked",!n.prop("checked"));f._syncSelected(n);return}f._syncSelected(n);f.sourceSelect.trigger("change","ddcl_internal");if(!f.isMultiple&&l.closeRadioOnClick){f._toggleDropContainer(false)}}});p.click(function(t){var n=e(this);t.stopImmediatePropagation();if(!n.hasClass("ui-state-disabled")){var r=n.find("input");var i=r.prop("checked");r.prop("checked",!i);var s=f.options.onItemClick;if(e.isFunction(s))try{s.call(f,r,c.get(0))}catch(o){r.prop("checked",i);f._syncSelected(r);return}f._syncSelected(r);f.sourceSelect.trigger("change","ddcl_internal");if(!i&&!f.isMultiple&&l.closeRadioOnClick){f._toggleDropContainer(false)}}else{n.focus();f._cancelBlur()}});p.focus(function(t){var n=e(this);t.stopImmediatePropagation()});p.keyup(function(e){f._handleKeyboard(e)});return p},_createGroupItem:function(t,n){var r=this;var i=e("<div />");i.addClass("ui-dropdownchecklist-group ui-widget-header");if(n){i.addClass("ui-state-disabled")}i.css({"white-space":"nowrap"});var s=e("<span/>");s.addClass("ui-dropdownchecklist-text");s.css({cursor:"default"});s.text(t);i.append(s);i.click(function(t){var n=e(this);t.stopImmediatePropagation();n.focus();r._cancelBlur()});i.focus(function(t){var n=e(this);t.stopImmediatePropagation()});return i},_createCloseItem:function(t){var n=this;var r=e("<div />");r.addClass("ui-state-default ui-dropdownchecklist-close ui-dropdownchecklist-item");r.css({"white-space":"nowrap","text-align":"right"});var i=e("<span/>");i.addClass("ui-dropdownchecklist-text");i.css({cursor:"default"});i.html(t);r.append(i);r.click(function(t){var r=e(this);t.stopImmediatePropagation();r.focus();n._toggleDropContainer(false)});r.hover(function(t){e(this).addClass("ui-state-hover")},function(t){e(this).removeClass("ui-state-hover")});r.focus(function(t){var n=e(this);t.stopImmediatePropagation()});return r},_appendItems:function(){var t=this,n=this.options,r=this.sourceSelect,i=this.dropWrapper;var s=i.find(".ui-dropdownchecklist-dropcontainer");r.children().each(function(n){var r=e(this);if(r.is("option")){t._appendOption(r,s,n,false,false)}else if(r.is("optgroup")){var i=r.prop("disabled");var o=r.attr("label");if(o!=""){var u=t._createGroupItem(o,i);s.append(u)}t._appendOptions(r,s,n,true,i)}});if(n.explicitClose!=null){var o=t._createCloseItem(n.explicitClose);s.append(o)}var u=s.outerWidth();var a=s.outerHeight();return{width:u,height:a}},_appendOptions:function(t,n,r,i,s){var o=this;t.children("option").each(function(t){var u=e(this);var a=r+"."+t;o._appendOption(u,n,a,i,s)})},_appendOption:function(e,t,n,r,i){var s=this;var o=e.html();if(o!=null&&o!=""){var u=e.val();var a=e.attr("style");var f=e.prop("selected");var l=i||e.prop("disabled");var c=s.controlSelector.attr("tabindex");var h=s._createDropItem(n,c,u,o,a,f,l,r);t.append(h)}},_syncSelected:function(t){var n=this,r=this.options,i=this.sourceSelect,s=this.dropWrapper;var o=i.get(0).options;var u=s.find("input.active");if(r.firstItemChecksAll=="exclusive"){if(t==null&&e(o[0]).prop("selected")){u.prop("checked",false);e(u[0]).prop("checked",true)}else if(t!=null&&t.attr("index")==0){var a=t.prop("checked");u.prop("checked",false);e(u[0]).prop("checked",a)}else{var f=true;var l=null;u.each(function(t){if(t>0){var n=e(this).prop("checked");if(!n){f=false}}else{l=e(this)}});if(l!=null){if(f){u.prop("checked",false)}l.prop("checked",f)}}}else if(r.firstItemChecksAll){if(t==null&&e(o[0]).prop("selected")){u.prop("checked",true)}else if(t!=null&&t.attr("index")==0){u.prop("checked",t.prop("checked"))}else{var f=true;var l=null;u.each(function(t){if(t>0){var n=e(this).prop("checked");if(!n){f=false}}else{l=e(this)}});if(l!=null){l.prop("checked",f)}}}var c=0;u=s.find("input");u.each(function(t){var n=e(o[t+c]);var r=n.html();if(r==null||r==""){c+=1;n=e(o[t+c])}n.prop("selected",e(this).prop("checked"))});n._updateControlText();if(t!=null){t.focus()}},_sourceSelectChangeHandler:function(e){var t=this,n=this.dropWrapper;n.find("input").val(t.sourceSelect.val());t._updateControlText()},_updateControlText:function(){var e=this,t=this.sourceSelect,n=this.options,r=this.controlWrapper;var i=t.find("option:first");var s=t.find("option");var o=e._formatText(s,n.firstItemChecksAll,i);var u=r.find(".ui-dropdownchecklist-text");u.html(o);u.attr("title",u.text())},_formatText:function(t,n,r){var i;if(e.isFunction(this.options.textFormatFunction)){try{i=this.options.textFormatFunction(t)}catch(s){alert("textFormatFunction failed: "+s)}}else if(n&&r!=null&&r.prop("selected")){i=r.html()}else{i="";t.each(function(){if(e(this).prop("selected")){if(i!=""){i+=", "}var t=e(this).attr("style");var n=e("<span/>");n.html(e(this).html());if(t==null){i+=n.html()}else{n.attr("style",t);i+=e("<span/>").append(n).html()}}});if(i==""){i=this.options.emptyText!=null?this.options.emptyText:" "}}return i},_toggleDropContainer:function(t){var n=this;var r=function(t){if(t!=null&&t.dropWrapper.isOpen){t.dropWrapper.isOpen=false;e.ui.dropdownchecklist.gLastOpened=null;var n=t.options;t.dropWrapper.css({top:"-33000px",left:"-33000px"});var i=t.controlSelector;i.removeClass("ui-state-active");i.removeClass("ui-state-hover");var s=t.controlWrapper.find(".ui-icon");if(s.length>0){s.removeClass(n.icon.toClose!=null?n.icon.toClose:"ui-icon-triangle-1-s");s.addClass(n.icon.toOpen!=null?n.icon.toOpen:"ui-icon-triangle-1-e")}e(document).unbind("click",r);t.dropWrapper.find("input.active").prop("disabled",true);if(e.isFunction(n.onComplete)){try{n.onComplete.call(t,t.sourceSelect.get(0))}catch(o){alert("callback failed: "+o)}}}};var i=function(t){if(!t.dropWrapper.isOpen){t.dropWrapper.isOpen=true;e.ui.dropdownchecklist.gLastOpened=t;var n=t.options;if(n.positionHow==null||n.positionHow=="absolute"){t.dropWrapper.css({position:"absolute",top:t.controlWrapper.position().top+t.controlWrapper.outerHeight()+"px",left:t.controlWrapper.position().left+"px"})}else if(n.positionHow=="relative"){t.dropWrapper.css({position:"relative",top:"0px",left:"0px"})}var i=0;if(n.zIndex==null){var s=t.controlWrapper.parents().map(function(){var t=e(this).css("z-index");return isNaN(t)?0:t}).get();var o=Math.max.apply(Math,s);if(o>=0)i=o+1}else{i=parseInt(n.zIndex)}if(i>0){t.dropWrapper.css({"z-index":i})}var u=t.controlSelector;u.addClass("ui-state-active");u.removeClass("ui-state-hover");var a=t.controlWrapper.find(".ui-icon");if(a.length>0){a.removeClass(n.icon.toOpen!=null?n.icon.toOpen:"ui-icon-triangle-1-e");a.addClass(n.icon.toClose!=null?n.icon.toClose:"ui-icon-triangle-1-s")}e(document).bind("click",function(e){r(t)});var f=t.dropWrapper.find("input.active");f.prop("disabled",false);var l=f.get(0);if(l!=null){l.focus()}}};if(t){r(e.ui.dropdownchecklist.gLastOpened);i(n)}else{r(n)}},_setSize:function(t){var n=this.options,r=this.dropWrapper,i=this.controlWrapper;var s=t.width;if(n.width!=null){s=parseInt(n.width)}else if(n.minWidth!=null){var o=parseInt(n.minWidth);if(s<o){s=o}}var u=this.controlSelector;u.css({width:s+"px"});var a=u.find(".ui-dropdownchecklist-text");var f=u.find(".ui-icon");if(f!=null){s-=f.outerWidth()+4;a.css({width:s+"px"})}s=i.outerWidth();var l=n.maxDropHeight!=null?parseInt(n.maxDropHeight):-1;var c=l>0&&t.height>l?l:t.height;var h=t.width<s?s:t.width;e(r).css({height:c+"px",width:h+"px"});r.find(".ui-dropdownchecklist-dropcontainer").css({height:c+"px"})},_init:function(){var t=this,n=this.options;if(e.ui.dropdownchecklist.gIDCounter==null){e.ui.dropdownchecklist.gIDCounter=1}t.blurringItem=null;var r=t.element;t.initialDisplay=r.css("display");r.css("display","none");t.initialMultiple=r.prop("multiple");t.isMultiple=t.initialMultiple;if(n.forceMultiple!=null){t.isMultiple=n.forceMultiple}r.prop("multiple",true);t.sourceSelect=r;var i=t._appendControl();t.controlWrapper=i;t.controlSelector=i.find(".ui-dropdownchecklist-selector");var s=t._appendDropContainer(i);t.dropWrapper=s;var o=t._appendItems();t._updateControlText(i,s,r);t._setSize(o);if(n.firstItemChecksAll){t._syncSelected(null)}if(n.bgiframe&&typeof t.dropWrapper.bgiframe=="function"){t.dropWrapper.bgiframe()}t.sourceSelect.change(function(e,n){if(n!="ddcl_internal"){t._sourceSelectChangeHandler(e)}})},_refreshOption:function(e,t,n){var r=e.parent();if(t){e.prop("disabled",true);e.removeClass("active");e.addClass("inactive");r.addClass("ui-state-disabled")}else{e.prop("disabled",false);e.removeClass("inactive");e.addClass("active");r.removeClass("ui-state-disabled")}e.prop("checked",n)},_refreshGroup:function(e,t){if(t){e.addClass("ui-state-disabled")}else{e.removeClass("ui-state-disabled")}},close:function(){this._toggleDropContainer(false)},refresh:function(){var t=this,n=this.sourceSelect,r=this.dropWrapper;var i=r.find("input");var s=r.find(".ui-dropdownchecklist-group");var o=0;var u=0;n.children().each(function(n){var r=e(this);var a=r.prop("disabled");if(r.is("option")){var f=r.prop("selected");var l=e(i[u]);t._refreshOption(l,a,f);u+=1}else if(r.is("optgroup")){var c=r.attr("label");if(c!=""){var h=e(s[o]);t._refreshGroup(h,a);o+=1}r.children("option").each(function(){var n=e(this);var r=a||n.prop("disabled");var s=n.prop("selected");var o=e(i[u]);t._refreshOption(o,r,s);u+=1})}});t._syncSelected(null)},enable:function(){this.controlSelector.removeClass("ui-state-disabled");this.disabled=false},disable:function(){this.controlSelector.addClass("ui-state-disabled");this.disabled=true},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments);this.sourceSelect.css("display",this.initialDisplay);this.sourceSelect.prop("multiple",this.initialMultiple);this.controlWrapper.unbind().remove();this.dropWrapper.remove()}});e.extend(e.ui.dropdownchecklist,{defaults:{width:null,maxDropHeight:null,firstItemChecksAll:false,closeRadioOnClick:false,minWidth:50,positionHow:"absolute",bgiframe:false,explicitClose:null}})})(jQuery)