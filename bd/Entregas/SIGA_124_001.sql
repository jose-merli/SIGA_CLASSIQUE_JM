Modificado PKG_SIGA_CARGOS;
Modificado PKG_SERVICIOS_AUTOMATICOS;

 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('censo.tipoCuenta.cargo.confirmacionProcesoAltaCuentaCargos', '¿Desea asociar las suscripciones activas con forma de pago en metálico a la nueva cuenta?', 0, '1', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('censo.tipoCuenta.cargo.confirmacionProcesoAltaCuentaCargos', '¿Desea asociar las suscripciones activas con forma de pago en metálico a la nueva cuenta?#GL', 0, '4', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('censo.tipoCuenta.cargo.confirmacionProcesoAltaCuentaCargos', '¿Desea asociar las suscripciones activas con forma de pago en metálico a la nueva cuenta?#CA', 0, '2', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('censo.tipoCuenta.cargo.confirmacionProcesoAltaCuentaCargos', '¿Desea asociar las suscripciones activas con forma de pago en metálico a la nueva cuenta?#EU', 0, '3', sysdate, 0, '19');
 
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('gratuita.confGuardia.literal.configuracionHistorica', 'Configuración histórica', 0, '1', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('gratuita.confGuardia.literal.configuracionHistorica', 'Configuración histórica#GL', 0, '4', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('gratuita.confGuardia.literal.configuracionHistorica', 'Configuración histórica#CA', 0, '2', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('gratuita.confGuardia.literal.configuracionHistorica', 'Configuración histórica#EU', 0, '3', sysdate, 0, '19');
 
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('gratuita.confGuardia.literal.configuracionHistorica.actual', 'Actual', 0, '1', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('gratuita.confGuardia.literal.configuracionHistorica.actual', 'Actual#GL', 0, '4', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('gratuita.confGuardia.literal.configuracionHistorica.actual', 'Actual#CA', 0, '2', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('gratuita.confGuardia.literal.configuracionHistorica.actual', 'Actual#EU', 0, '3', sysdate, 0, '19'); 
 
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('facturacion.datosFactura.boton.DescargarFacturaSinRegenerarPDF', 'Descargar PDF', 0, '1', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('facturacion.datosFactura.boton.DescargarFacturaSinRegenerarPDF', 'Descargar PDF#GL', 0, '4', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('facturacion.datosFactura.boton.DescargarFacturaSinRegenerarPDF', 'Descargar PDF#CA', 0, '2', sysdate, 0, '19');
 insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('facturacion.datosFactura.boton.DescargarFacturaSinRegenerarPDF', 'Descargar PDF#EU', 0, '3', sysdate, 0, '19');
 
insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('censo.mutualidad.aviso.rangoEdad', 'La edad debe estar comprendida entre 18 y 50 años. Compruebe la fecha de nacimiento.', 0, '1', sysdate, 0, '19');
insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('censo.mutualidad.aviso.rangoEdad', 'La edad debe estar comprendida entre 18 y 50 años. Compruebe la fecha de nacimiento.#GL', 0, '4', sysdate, 0, '19');
insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('censo.mutualidad.aviso.rangoEdad', 'La edad debe estar comprendida entre 18 y 50 años. Compruebe la fecha de nacimiento.#CA', 0, '2', sysdate, 0, '19');
insert into GEN_RECURSOS (IDRECURSO, DESCRIPCION, ERROR, IDLENGUAJE, FECHAMODIFICACION, USUMODIFICACION, IDPROPIEDAD) values ('censo.mutualidad.aviso.rangoEdad', 'La edad debe estar comprendida entre 18 y 50 años. Compruebe la fecha de nacimiento.#EU', 0, '3', sysdate, 0, '19');

CREATE OR REPLACE FUNCTION F_SIGA_ESTADOSOLCENTRALITA(P_IDINSTITUCION IN SCS_SOLICITUD_ACEPTADA.IDINSTITUCION%TYPE,
                                                            P_IDSOLICITUD   IN SCS_SOLICITUD_ACEPTADA.IDSOLICITUD%TYPE,
                                                            P_DESCRIPCIONCONFIRMADA IN GEN_RECURSOS.DESCRIPCION%TYPE)
  RETURN VARCHAR2 IS

  /****************************************************************************************************************/
  /* NOMBRE:        F_SIGA_ESTADOSOLICITUDCENTRALITA                                                                         */
  /* DESCRIPCION:   FUNCION QUE NOS SACA LA DESCRIPCION DEL ESTADO DE UNA SOLICITUD CONFIRMADA DE CENTRALITA. CONCATENARA LAS ASISTENCIAS CREADAS DESDE ESTA SOLICITUD        */
  /****************************************************************************************************************/

  /* DECLARACION DE VARIABLES */

  V_SALIDA VARCHAR2(250);

  CURSOR C_ASISTENCIAS IS
    SELECT (ANIO || '/' || NUMERO) ASISTENCIA
      FROM SCS_ASISTENCIA
     WHERE IDINSTITUCION = P_IDINSTITUCION
       AND IDSOLICITUDCENTRALITA = P_IDSOLICITUD
     ORDER BY ANIO DESC,NUMERO DESC;

BEGIN

  FOR I IN C_ASISTENCIAS LOOP
    V_SALIDA := V_SALIDA || I.ASISTENCIA || ', ';
  END LOOP;
  V_SALIDA := P_DESCRIPCIONCONFIRMADA||' ('||V_SALIDA;
  V_SALIDA := RTRIM(TRIM(V_SALIDA), ',');
  V_SALIDA := V_SALIDA||')';

  RETURN(V_SALIDA);
END F_SIGA_ESTADOSOLCENTRALITA;


